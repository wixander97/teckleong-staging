# -*- coding: utf-8 -*-
#################################################################################
# Author      : Webkul Software Pvt. Ltd. (<https://webkul.com/>)
# Copyright(c): 2015-Present Webkul Software Pvt. Ltd.
# License URL : https://store.webkul.com/license.html/
# All Rights Reserved.
#
#
#
# This program is copyright property of the author mentioned above.
# You can`t redistribute it and/or modify it.
#
#
# You should have received a copy of the License along with this program.
# If not, see <https://store.webkul.com/license.html/>
#################################################################################

from odoo import models, fields, api, _
from odoo.exceptions import UserError, ValidationError, AccessError
from odoo import SUPERUSER_ID
import re
import time
from datetime import datetime, timedelta, date
from dateutil.parser import parse

import logging
_logger = logging.getLogger(__name__)

class SaleOrder(models.Model):
    _inherit = "sale.order"

    def action_create_custom_po(self):
        print("Test")


    @api.onchange('validity_date')
    def _validity_date(self):
        for line in self:
            if line.validity_date == False:
               line.validity_date = (datetime.now()+timedelta(days=5))

    @api.model_create_multi
    def create(self,vals):
        for values in vals:
            date = values.get('commitment_date')
            if date == False:
                values['commitment_date'] = (datetime.now()+timedelta(days=5))
        return super(SaleOrder, self).create(vals)   

   

    def action_confirm(self):
        res = super(SaleOrder, self).action_confirm()

        job_order_line_ids = []

        for custom_line in self.custom_dimension_line_ids:
            product_name = custom_line.parent_product_id.name
            if custom_line.parent_product_id.default_code:
                product_sku = custom_line.parent_product_id.default_code + '-'
            else:
                product_sku = ''

            if custom_line.parent_product_id.width != custom_line.width:
                width_code = str(int(custom_line.width))

                if not len(width_code) >= 4:
                    while len(width_code) != 4:
                        width_code = '0' + width_code

                product_name += " x " + str(int(custom_line.width)) + "mm"

                # if (custom_line.width / 1000).is_integer():
                #     product_name += " x " + str(int(custom_line.width / 1000)) + " m"
                # else:
                #     product_name += " x " + str(int(custom_line.width)) + " mm"

                product_sku += width_code        

            if custom_line.parent_product_id.length != custom_line.length:
                length_code = str(int(custom_line.length))

                if not len(length_code) >= 4:
                    while len(length_code) != 4:
                        length_code = '0' + length_code

                # if (custom_line.length / 1000).is_integer():
                #     product_name += " x " + str(int(custom_line.length / 1000)) + " m"
                # else:
                #     product_name += " x " + str(int(custom_line.length)) + " mm"

                product_name += " x " + str(int(custom_line.length)) + "mm"

                product_sku += length_code

            product_id = custom_line.parent_product_id.id
            child_roduct = self.env['product.product'].search([
                ('default_code', '=', product_sku)
                # ('parent_product_id', '=', product_id ),
                # ('diameter', '=',custom_line.diameter ),
                # ('height', '=',custom_line.height ),
                # ('width', '=',custom_line.width ),
                # ('thickness', '=',custom_line.thickness ),
                # ('length', '=',custom_line.length ),
                # ('kg', '=',custom_line.kg ),
            ], limit=1)            
                
            if child_roduct:
                product = child_roduct
            else : 
                product = self.env['product.product'].create({
                    'name': product_name,
                    'default_code': product_sku,
                    'diameter': custom_line.diameter,
                    'height': custom_line.height,
                    'width': custom_line.width,
                    'thickness': custom_line.thickness,
                    'length': custom_line.length,
                    'kg': custom_line.kg,
                    'outer_diameter': custom_line.outer_diameter,
                    'across_flat': custom_line.across_flat,
                    'breadth': custom_line.breadth,
                    'mesh_number': custom_line.mesh_number,
                    'mesh_size': custom_line.mesh_size,
                    'hole_diameter': custom_line.hole_diameter,
                    'number': custom_line.number,
                    'opening_dimension': custom_line.opening_dimension,
                    'metric_number': custom_line.metric_number,
                    'size': custom_line.size,
                    'dimension_uom_id': custom_line.dimension_uom_id.id,
                    'parent_product_id': custom_line.parent_product_id.id,
                    'uom_id': custom_line.product_uom_id.id,
                    'uom_po_id': custom_line.product_uom_id.id,
                    'detailed_type': 'product',
                    'tracking': 'lot',
                    'categ_id': custom_line.parent_product_id.categ_id.id,
                })
                
            if custom_line.is_parent_id:   
                job_order_line_ids.append((0, 0, {
                    'requested_height': custom_line.height,
                    'requested_width': custom_line.width,
                    'requested_length': custom_line.length,
                    'requested_thickness': custom_line.thickness,
                    'requested_diameter': custom_line.diameter,
                    'requested_kg': custom_line.kg,
                    'product_uom_id': custom_line.dimension_uom_id.id,
                    'quantity': custom_line.quantity,
                    'product_id': product.id,
                    'receipt_location_id': self.warehouse_id.lot_stock_id.id,
                }))
            
            self.order_line.create({
                'product_id': product.id,
                'product_uom_qty': custom_line.quantity,
                'price_unit': custom_line.unit_price,
                'tax_id': custom_line.tax_ids._ids,
                'order_id': self.id,
                'name': product.name,
                'product_uom': custom_line.product_uom_id.id,
            })    
                        
        job_order = False

        if len(job_order_line_ids) > 0 : 
            job_order = self.env['job.order'].create({
                'sale_order_id': self.id,
                'job_order_line_ids': job_order_line_ids,
                'location_id': self.warehouse_id.id,
                'datetime': self.date_order,
            })

        if job_order:
            job_order_cutting_ids = []

            for line in job_order.job_order_line_ids:
                if line.is_have_width and line.is_have_length and line.parent_product_id.product_tmpl_id.width == 0 and line.parent_product_id.product_tmpl_id.length == 0:
                    continue

                product_arr = self.env['product.product'].search([
                    ('parent_product_id', '=', line.parent_product_id.id),
                    ('id', '!=', line.product_id.id),
                    ('qty_available', '>', 0)
                ])

                if product_arr:
                    if line.is_have_length and line.parent_product_id.product_tmpl_id.length == 0:
                        length_sum = line.requested_length * line.quantity
                        product_arr_length = product_arr.filtered(lambda x: x.length > line.requested_length).sorted(key=lambda x:x.length)
                        stocks = self.env['stock.quant'].search([
                            ('product_id', 'in', product_arr_length._ids),
                            ('quantity', '>', 0)
                        ], order='id asc')

                        if stocks.filtered(lambda x: x.product_id.length == length_sum):
                            filtered_stocks = stocks.filtered(lambda x: x.product_id.length == length_sum)
                            selected_stock = False

                            if filtered_stocks.filtered(lambda x: x.location_id.warehouse_id == self.warehouse_id):
                                selected_stock = filtered_stocks.filtered(lambda x: x.location_id.warehouse_id == self.warehouse_id)[0]
                            else:
                                selected_stock = filtered_stocks[0]

                            job_order_cutting_ids.append({
                                'job_order_id_char': int(job_order.id),
                                'job_order_line_id': line.id,
                                'stock_quantity_id': selected_stock.id,
                                'done_quantity': line.quantity,
                                'warehouse_id': selected_stock.location_id.warehouse_id.id,

                                'length_balance': 0,
                                'width_balance': selected_stock.product_id.width,
                                'height_balance': selected_stock.product_id.height,
                                'diameter_balance': selected_stock.product_id.diameter,
                                'thickness_balance': selected_stock.product_id.thickness,
                                'kg_balance': selected_stock.product_id.kg,
                            })

                        else:
                            quantity = line.quantity
                            filtered_stocks = stocks

                            if stocks.filtered(lambda x: x.location_id.warehouse_id == self.warehouse_id):
                                filtered_stocks = stocks.filtered(lambda x: x.location_id.warehouse_id == self.warehouse_id)

                            for stock in filtered_stocks:
                                if quantity > 0:
                                    for i in range(int(stock.quantity)):
                                        if quantity > 0:
                                            stock_product_length = stock.product_id.length
                                            done_quantity = 0

                                            while(stock_product_length > line.requested_length and quantity > 0):
                                                stock_product_length -= line.requested_length
                                                quantity -= 1
                                                done_quantity += 1

                                            job_order_cutting_ids.append({
                                                'job_order_id_char': int(job_order.id),
                                                'job_order_line_id': line.id,
                                                'stock_quantity_id': stock.id,
                                                'done_quantity': done_quantity,
                                                'warehouse_id': stock.location_id.warehouse_id.id,

                                                'length_balance': stock_product_length,
                                                'width_balance': stock.product_id.width,
                                                'height_balance': stock.product_id.height,
                                                'diameter_balance': stock.product_id.diameter,
                                                'thickness_balance': stock.product_id.thickness,
                                                'kg_balance': stock.product_id.kg,
                                            })

                                        else:
                                            break
                                else:
                                    break;

                    elif line.is_have_width and line.parent_product_id.product_tmpl_id.width == 0:
                        width_sum = line.requested_width * line.quantity
                        product_arr_width = product_arr.filtered(lambda x: x.width > line.requested_width).sorted(key=lambda x:x.width)
                        stocks = self.env['stock.quant'].search([
                            ('product_id', 'in', product_arr_width._ids),
                            ('quantity', '>', 0)
                        ], order='id asc')

                        if stocks.filtered(lambda x: x.product_id.width == width_sum):
                            filtered_stocks = stocks.filtered(lambda x: x.product_id.width == width_sum)
                            selected_stock = False

                            if filtered_stocks.filtered(lambda x: x.location_id.warehouse_id == self.warehouse_id):
                                selected_stock = filtered_stocks.filtered(lambda x: x.location_id.warehouse_id == self.warehouse_id)[0]
                            else:
                                selected_stock = filtered_stocks[0]

                            job_order_cutting_ids.append({
                                'job_order_id_char': int(job_order.id),
                                'job_order_line_id': line.id,
                                'stock_quantity_id': selected_stock.id,
                                'done_quantity': line.quantity,
                                'warehouse_id': selected_stock.location_id.warehouse_id.id,

                                'length_balance': selected_stock.product_id.length,
                                'width_balance': 0,
                                'height_balance': selected_stock.product_id.height,
                                'diameter_balance': selected_stock.product_id.diameter,
                                'thickness_balance': selected_stock.product_id.thickness,
                                'kg_balance': selected_stock.product_id.kg,
                            })

                        else:
                            quantity = line.quantity
                            filtered_stocks = stocks

                            if stocks.filtered(lambda x: x.location_id.warehouse_id == self.warehouse_id):
                                filtered_stocks = stocks.filtered(lambda x: x.location_id.warehouse_id == self.warehouse_id)

                            for stock in filtered_stocks:
                                if quantity > 0:
                                    for i in range(int(stock.quantity)):
                                        if quantity > 0:
                                            stock_product_width = stock.product_id.width
                                            done_quantity = 0

                                            while(stock_product_width > line.requested_width and quantity > 0):
                                                stock_product_width -= line.requested_width
                                                quantity -= 1
                                                done_quantity += 1

                                            job_order_cutting_ids.append({
                                                'job_order_id_char': int(job_order.id),
                                                'job_order_line_id': line.id,
                                                'stock_quantity_id': stock.id,
                                                'done_quantity': done_quantity,
                                                'warehouse_id': stock.location_id.warehouse_id.id,

                                                'length_balance': stock_product_length,
                                                'width_balance': stock_product_width,
                                                'height_balance': stock.product_id.height,
                                                'diameter_balance': stock.product_id.diameter,
                                                'thickness_balance': stock.product_id.thickness,
                                                'kg_balance': stock.product_id.kg,
                                            })

                                        else:
                                            break
                                else:
                                    break;

            multi_location = False

            for job in job_order_cutting_ids:
                if job['warehouse_id'] != self.warehouse_id.id:
                    multi_location = True
                    break;

            if not multi_location:
                for job in job_order_cutting_ids:
                    job_order.job_order_cutting_ids = [(0, 0, {
                        'stock_quantity_id': job['stock_quantity_id'],
                        'line_ids': [(0, 0, {
                            'job_order_line_id': job['job_order_line_id'],
                            'done_quantity': job['done_quantity'],
                        })],
                        'balance_ids': [(0, 0, {
                            'length_balance': job['length_balance'],
                            'height_balance': job['height_balance'],
                            'width_balance': job['width_balance'],
                            'diameter_balance': job['diameter_balance'],
                            'thickness_balance': job['thickness_balance'],
                            'kg_balance': job['kg_balance'],
                        })],
                    })]

            else:
                job_order.type = 'multiple_location'

                for line in job_order.job_order_line_ids:
                    for job in job_order_cutting_ids:
                        if line.id == job['job_order_line_id']:
                            line.location_id = job['warehouse_id']
                            break;

                job_order.action_confirm()

                for child in job_order.job_order_child_ids:
                    for job in job_order_cutting_ids:
                        if child.job_order_line_id.id == job['job_order_line_id']:
                            child.job_order_cutting_ids = [(0, 0, {
                                'stock_quantity_id': job['stock_quantity_id'],
                                'line_ids': [(0, 0, {
                                    'job_order_line_id': job['job_order_line_id'],
                                    'done_quantity': job['done_quantity'],
                                })],
                                'balance_ids': [(0, 0, {
                                    'length_balance': job['length_balance'],
                                    'height_balance': job['height_balance'],
                                    'width_balance': job['width_balance'],
                                    'diameter_balance': job['diameter_balance'],
                                    'thickness_balance': job['thickness_balance'],
                                    'kg_balance': job['kg_balance'],
                                })],
                            })]

                            break;

        return res

    def action_view_job_order(self):
        self.ensure_one()

        return {
            'name': 'Job Order',
            'type': 'ir.actions.act_window',
            'view_mode': 'tree,form',
            'res_model': 'job.order',
            'domain': [('sale_order_id', '=', self.id)],
            'target': 'current',
        }

    custom_dimension_line_ids = fields.One2many('sale.order.custom.dimension.line', 'order_id', string='Custom Dimension Line')
    job_order_ids = fields.One2many('job.order', 'sale_order_id', string='Job Order')
    is_subcontractor = fields.Boolean('Subcontractor')

class SaleOrderLine(models.Model):
    _inherit = 'sale.order.line'

    electrode_number = fields.Char('Electrode Number')
    batch_number = fields.Char('Batch Number')

class SaleOrderCustomDimensionLine(models.Model):
    _name = "sale.order.custom.dimension.line"
    _description = "Sale Order Custom Dimension Line"

    @api.onchange('parent_product_id')
    def onchange_parent_product_id(self):
        self.diameter = self.parent_product_id.product_tmpl_id.diameter
        self.thickness = self.parent_product_id.product_tmpl_id.thickness
        self.width = self.parent_product_id.product_tmpl_id.width
        self.length = self.parent_product_id.product_tmpl_id.length
        self.height = self.parent_product_id.product_tmpl_id.height
        self.kg = self.parent_product_id.product_tmpl_id.kg
        self.outer_diameter = self.parent_product_id.product_tmpl_id.outer_diameter
        self.across_flat = self.parent_product_id.product_tmpl_id.across_flat
        self.breadth = self.parent_product_id.product_tmpl_id.breadth
        self.mesh_number = self.parent_product_id.product_tmpl_id.mesh_number
        self.mesh_size = self.parent_product_id.product_tmpl_id.mesh_size
        self.hole_diameter = self.parent_product_id.product_tmpl_id.hole_diameter
        self.number = self.parent_product_id.product_tmpl_id.number
        self.opening_dimension = self.parent_product_id.product_tmpl_id.opening_dimension
        self.metric_number = self.parent_product_id.product_tmpl_id.metric_number
        self.size = self.parent_product_id.product_tmpl_id.size

        self.product_uom_id = self.parent_product_id.product_tmpl_id.uom_id
        self.unit_price = self.parent_product_id.product_tmpl_id.list_price
        self.description = self.parent_product_id.product_tmpl_id.name
        self.dimension_uom_id = self.parent_product_id.product_tmpl_id.dimension_uom_id
        self.is_parent_id = self.parent_product_id.product_tmpl_id.is_parent_product
        self.is_have_diameter = self.parent_product_id.product_tmpl_id.categ_id.is_have_diameter
        self.is_have_height = self.parent_product_id.product_tmpl_id.categ_id.is_have_height
        self.is_have_width = self.parent_product_id.product_tmpl_id.categ_id.is_have_width
        self.is_have_thickness = self.parent_product_id.product_tmpl_id.categ_id.is_have_thickness
        self.is_have_length = self.parent_product_id.product_tmpl_id.categ_id.is_have_length
        self.is_have_kg = self.parent_product_id.product_tmpl_id.categ_id.is_have_kg

        self.is_have_outer_diameter = self.parent_product_id.product_tmpl_id.categ_id.is_have_outer_diameter
        self.is_have_across_flat = self.parent_product_id.product_tmpl_id.categ_id.is_have_across_flat
        self.is_have_breadth = self.parent_product_id.product_tmpl_id.categ_id.is_have_breadth
        self.is_have_mesh_number = self.parent_product_id.product_tmpl_id.categ_id.is_have_mesh_number
        self.is_have_mesh_size = self.parent_product_id.product_tmpl_id.categ_id.is_have_mesh_size
        self.is_have_hole_diameter = self.parent_product_id.product_tmpl_id.categ_id.is_have_hole_diameter
        self.is_have_number = self.parent_product_id.product_tmpl_id.categ_id.is_have_number
        self.is_have_opening_dimension = self.parent_product_id.product_tmpl_id.categ_id.is_have_opening_dimension
        self.is_have_metric_number = self.parent_product_id.product_tmpl_id.categ_id.is_have_metric_number
        self.is_have_size = self.parent_product_id.product_tmpl_id.categ_id.is_have_size

        self.master_width = self.parent_product_id.product_tmpl_id.width
        self.master_length = self.parent_product_id.product_tmpl_id.length
        self.master_height = self.parent_product_id.product_tmpl_id.height
        self.master_diameter = self.parent_product_id.product_tmpl_id.diameter
        self.master_thickness = self.parent_product_id.product_tmpl_id.thickness
        self.master_kg = self.parent_product_id.product_tmpl_id.kg
        self.master_outer_diameter  = self.parent_product_id.product_tmpl_id.outer_diameter
        self.master_across_flat = self.parent_product_id.product_tmpl_id.across_flat
        self.master_breadth = self.parent_product_id.product_tmpl_id.breadth
        self.master_mesh_number = self.parent_product_id.product_tmpl_id.mesh_number
        self.master_mesh_size = self.parent_product_id.product_tmpl_id.mesh_size
        self.master_hole_diameter = self.parent_product_id.product_tmpl_id.hole_diameter
        self.master_number = self.parent_product_id.product_tmpl_id.number
        self.master_opening_dimension = self.parent_product_id.product_tmpl_id.opening_dimension
        self.master_metric_number = self.parent_product_id.product_tmpl_id.metric_number
        self.master_size = self.parent_product_id.product_tmpl_id.size

    @api.depends('tax_ids')
    def _compute_tax_price(self):
        for line in self:
            tax_price = 0

            for tax in line.tax_ids:
                tax_price += line.unit_price * tax.amount / 100 * line.quantity

            line.tax_price = tax_price

    @api.depends('parent_product_id','width','length')
    def _compute_child_product(self):
        for line in self:
            product_name = line.name

            if line.parent_product_id.width != line.width:
                width_code = str(int(line.width))

                if not len(width_code) >= 4:
                    while len(width_code) != 4:
                        width_code = '0' + width_code

                product_name += " x " + str(int(line.width)) + " mm"  
            if line.parent_product_id.length != line.length:
                length_code = str(int(line.length))

                if not len(length_code) >= 4:
                    while len(length_code) != 4:
                        length_code = '0' + length_code

                product_name += " x " + str(int(line.length)) + " mm"
            
            line.child_product = product_name

    @api.depends('parent_product_id', 'tax_ids', 'quantity', 'unit_price')
    def _compute_subtotal(self):
        for line in self:
            subtotal = 0 

            subtotal = line.unit_price * line.quantity + line.tax_price

            line.subtotal = subtotal

    @api.onchange('diameter')
    def onchange_diameter(self):
        if self.is_parent_id:
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_diameter:
                    if self.parent_product_id.product_tmpl_id.diameter > 0 and self.parent_product_id.product_tmpl_id.diameter != self.diameter:
                        self.diameter = 0
                        raise ValidationError("You Cannot change this Product Diameter.")
                else:
                    self.diameter = 0
                    # raise ValidationError("This Product doesn't have Diameter.")

    @api.onchange('height')
    def onchange_height(self):
        if self.is_parent_id:
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_height:
                    if self.parent_product_id.product_tmpl_id.height > 0 and self.parent_product_id.product_tmpl_id.height != self.height:
                        self.height = 0
                        raise ValidationError("You Cannot change this Product Height.")
                else:
                    self.height = 0
                    # raise ValidationError("This Product doesn't have Height.")

    @api.onchange('width')
    def onchange_width(self):
        if self.is_parent_id:
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_width:
                    if self.parent_product_id.product_tmpl_id.width > 0 and self.parent_product_id.product_tmpl_id.width != self.width:
                        self.width = 0
                        raise ValidationError("You Cannot change this Product Width.")
                else:
                    self.width = 0
                    # raise ValidationError("This Product doesn't have Width.")

    @api.onchange('thickness')
    def onchange_thickness(self):
        if self.is_parent_id:
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_thickness:
                    if self.parent_product_id.product_tmpl_id.thickness > 0 and self.parent_product_id.product_tmpl_id.thickness != self.thickness:
                        self.thickness = 0
                        raise ValidationError("You Cannot change this Product Thickness.")
                else:
                    self.thickness = 0
                    # raise ValidationError("This Product doesn't have Thickness.")

    @api.onchange('length')
    def onchange_length(self):
        if self.is_parent_id:
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_length:
                    if self.parent_product_id.product_tmpl_id.length > 0 and self.parent_product_id.product_tmpl_id.length != self.length:
                        self.length = 0
                        raise ValidationError("You Cannot change this Product Length.")
                else:
                    self.length = 0
                    # raise ValidationError("This Product doesn't have Length.")

    @api.onchange('kg')
    def onchange_kg(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_kg:
                    if self.parent_product_id.product_tmpl_id.kg > 0 and self.parent_product_id.product_tmpl_id.kg != self.kg:
                        self.kg = 0
                        raise ValidationError("You Cannot change this Product kg.")
                else:
                    self.kg = 0
                    # raise ValidationError("This Product doesn't have kg.")
    
    @api.onchange('outer_diameter')
    def onchange_outer_diameter(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_outer_diameter:
                    if self.parent_product_id.product_tmpl_id.outer_diameter > 0 and self.parent_product_id.product_tmpl_id.outer_diameter != self.outer_diameter:
                        self.outer_diameter = 0
                        raise ValidationError("You Cannot change this Product outer diameter.")
                else:
                    self.outer_diameter = 0
                    # raise ValidationError("This Product doesn't have kg.")
    
    @api.onchange('across_flat')
    def onchange_across_flat(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_across_flat:
                    if self.parent_product_id.product_tmpl_id.across_flat > 0 and self.parent_product_id.product_tmpl_id.across_flat != self.across_flat:
                        self.across_flat = 0
                        raise ValidationError("You Cannot change this Product across flat.")
                else:
                    self.across_flat = 0
                    # raise ValidationError("This Product doesn't have across flat.")

    @api.onchange('breadth')
    def onchange_breadth(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_breadth:
                    if self.parent_product_id.product_tmpl_id.breadth > 0 and self.parent_product_id.product_tmpl_id.breadth != self.breadth:
                        self.breadth = 0
                        raise ValidationError("You Cannot change this Product breadth.")
                else:
                    self.breadth = 0
                    # raise ValidationError("This Product doesn't have kg.")
    
    @api.onchange('mesh_number')
    def onchange_mesh_number(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_mesh_number:
                    if self.parent_product_id.product_tmpl_id.mesh_number > 0 and self.parent_product_id.product_tmpl_id.mesh_number != self.mesh_number:
                        self.mesh_number = 0
                        raise ValidationError("You Cannot change this Product mesh number.")
                else:
                    self.mesh_number = 0
                    # raise ValidationError("This Product doesn't have kg.")
    
    @api.onchange('mesh_size')
    def onchange_mesh_size(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_mesh_size:
                    if self.parent_product_id.product_tmpl_id.mesh_size > 0 and self.parent_product_id.product_tmpl_id.mesh_size != self.mesh_size:
                        self.mesh_size = 0
                        raise ValidationError("You Cannot change this Product mesh size.")
                else:
                    self.mesh_size = 0
                    # raise ValidationError("This Product doesn't have kg.")


    @api.onchange('hole_diameter')
    def onchange_hole_diameter(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_hole_diameter:
                    if self.parent_product_id.product_tmpl_id.hole_diameter > 0 and self.parent_product_id.product_tmpl_id.hole_diameter != self.hole_diameter:
                        self.hole_diameter = 0
                        raise ValidationError("You Cannot change this Product hole diameter.")
                else:
                    self.hole_diameter = 0
                    # raise ValidationError("This Product doesn't have kg.")
    
    @api.onchange('number')
    def onchange_number(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_number:
                    if self.parent_product_id.product_tmpl_id.number > 0 and self.parent_product_id.product_tmpl_id.number != self.number:
                        self.number = 0
                        raise ValidationError("You Cannot change this Product number.")
                else:
                    self.number = 0
                    # raise ValidationError("This Product doesn't have kg.")

    @api.onchange('opening_dimension')
    def onchange_opening_dimension(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_opening_dimension:
                    if self.parent_product_id.product_tmpl_id.opening_dimension > 0 and self.parent_product_id.product_tmpl_id.opening_dimension != self.opening_dimension:
                        self.opening_dimension = 0
                        raise ValidationError("You Cannot change this Product opening dimension.")
                else:
                    self.opening_dimension = 0
                    # raise ValidationError("This Product doesn't have kg.")
    
    @api.onchange('metric_number')
    def onchange_metric_number(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_metric_number:
                    if self.parent_product_id.product_tmpl_id.metric_number > 0 and self.parent_product_id.product_tmpl_id.metric_number != self.metric_number:
                        self.metric_number = 0
                        raise ValidationError("You Cannot change this Product metric_number.")
                else:
                    self.metric_number = 0
                    # raise ValidationError("This Product doesn't have kg.")
    
    @api.onchange('size')
    def onchange_size(self):
            if self.parent_product_id and self.parent_product_id.product_tmpl_id.categ_id:
                if self.parent_product_id.product_tmpl_id.categ_id.is_have_size:
                    if self.parent_product_id.product_tmpl_id.size > 0 and self.parent_product_id.product_tmpl_id.size != self.size:
                        self.size = 0
                        raise ValidationError("You Cannot change this Product size.")
                else:
                    self.size = 0
                    # raise ValidationError("This Product doesn't have kg.")

    def action_view_custom_stock(self):
        print("Test")

    parent_product_id = fields.Many2one('product.product', string='Parent Product')
    name = fields.Char('Product',related='parent_product_id.product_tmpl_id.name')
    # is_parent_id = fields.Many2one('product.template', string='Cek Product', related='parent_product_id.parent_product_id')
    is_parent_id = fields.Boolean('Have Parent')
    description = fields.Text('Description')

    width = fields.Float('Width')
    length = fields.Float('Length')
    height = fields.Float('Height')
    diameter = fields.Float('Diameter')
    thickness = fields.Float('Thickness')
    electrode_number = fields.Char('Electrode Number')
    batch_number = fields.Char('Batch Number')
    kg = fields.Float('Kg')
    outer_diameter  = fields.Float('Outer Diameter')
    across_flat = fields.Float('Across Flat')
    breadth = fields.Float('Breadth')
    mesh_number = fields.Float('Mesh Number')
    mesh_size = fields.Float('Mesh Size')
    hole_diameter = fields.Float('Hole Diameter')
    number = fields.Float('Number')
    opening_dimension = fields.Float('Opening Dimension')
    metric_number = fields.Float('Metric Number')
    size = fields.Float('Size')

    master_width = fields.Float('Width')
    master_length = fields.Float('Length')
    master_height = fields.Float('Height')
    master_diameter = fields.Float('Diameter')
    master_thickness = fields.Float('Thickness')
    master_kg = fields.Float('Kg')
    master_outer_diameter  = fields.Float('Outer Diameter')
    master_across_flat = fields.Float('Across Flat')
    master_breadth = fields.Float('Breadth')
    master_mesh_number = fields.Float('Mesh Number')
    master_mesh_size = fields.Float('Mesh Size')
    master_hole_diameter = fields.Float('Hole Diameter')
    master_number = fields.Float('Number')
    master_opening_dimension = fields.Float('Opening Dimension')
    master_metric_number = fields.Float('Metric Number')
    master_size = fields.Float('Size')

    dimension_uom_id = fields.Many2one('uom.uom', string='Dimension UoM')
    product_uom_id = fields.Many2one('uom.uom', string='UoM')
    unit_price = fields.Float('Unit Price')
    tax_ids = fields.Many2many('account.tax', string='Taxes')
    tax_price = fields.Float('Tax Price', compute='_compute_tax_price')
    child_product = fields.Char('Child Product', compute='_compute_child_product')

    subtotal = fields.Float('Subtotal', compute='_compute_subtotal')
    quantity = fields.Float('Qty', default=1)
    order_id = fields.Many2one('sale.order', string='Order Reference')
    is_have_diameter = fields.Boolean('Diameter')
    is_have_height = fields.Boolean('Height')
    is_have_width = fields.Boolean('Width')
    is_have_thickness = fields.Boolean('Thickness')
    is_have_length = fields.Boolean('Length')
    is_have_kg = fields.Boolean('Kg')
    is_have_outer_diameter = fields.Boolean('Outer Diameter')
    is_have_across_flat = fields.Boolean('Across Flat')
    is_have_breadth = fields.Boolean('Breadth')
    is_have_mesh_number = fields.Boolean('Mesh Number')
    is_have_mesh_size = fields.Boolean('Mesh Size')
    is_have_hole_diameter = fields.Boolean('Hole Diameter')
    is_have_number = fields.Boolean('Number')
    is_have_opening_dimension = fields.Boolean('Opening Dimension')
    is_have_metric_number = fields.Boolean('Metric Number')
    is_have_size = fields.Boolean('Size')